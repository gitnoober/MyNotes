{"ast":null,"code":"import _asyncToGenerator from\"/home/ps/Documents/notestest/notesfrontendtest/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/ps/Documents/notestest/notesfrontendtest/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/ps/Documents/notestest/notesfrontendtest/node_modules/@babel/runtime/regenerator/index.js\";import{createContext,useState,useEffect}from\"react\";import jwt_decode from\"jwt-decode\";import{useHistory}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setauthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem('authTokens')?jwt_decode(localStorage.getItem('authTokens')):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setloading=_useState6[1];var history=useHistory();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();// console.log('Form submitted')\n_context.next=3;return fetch('http://127.0.0.1:8000/api/token/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'username':e.target.username.value,'password':e.target.password.value})});case 3:response=_context.sent;console.log(response,\"response of login user\");if(!response.ok){_context.next=15;break;}_context.next=8;return response.json();case 8:data=_context.sent;setauthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));history.push('/');// console.log('data:', data)\n// console.log(\"response:\" , response);\n// console.log(\"userrr\", user)\n_context.next=16;break;case 15:alert('Something went wrong!');case 16:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setauthTokens(null);setUser(null);localStorage.removeItem('authTokens');history.push('/login');};var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('Update Token Called');_context2.next=3;return fetch('http://127.0.0.1:8000/api/token/refresh/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'refresh':authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});case 3:response=_context2.sent;if(!(response.status===200)){_context2.next=13;break;}_context2.next=7;return response.json();case 7:data=_context2.sent;setauthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));_context2.next=14;break;case 13:logoutUser();case 14:if(loading){setloading(false);}case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function updateToken(){return _ref3.apply(this,arguments);};}();var registerUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.next=3;return fetch('http://127.0.0.1:8000/api/register/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'username':e.target.username.value,'password':e.target.password1.value,'password2':e.target.password2.value})});case 3:response=_context3.sent;case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function registerUser(_x2){return _ref4.apply(this,arguments);};}();var contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser,registerUser:registerUser};useEffect(function(){if(loading){updateToken();}var fourmin=1000*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourmin);// console.log(\"called\")\nreturn function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:children});};","map":{"version":3,"sources":["/home/ps/Documents/notestest/notesfrontendtest/src/context/AuthContext.js"],"names":["createContext","useState","useEffect","jwt_decode","useHistory","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setauthTokens","user","setUser","loading","setloading","history","loginUser","e","preventDefault","fetch","method","headers","body","stringify","target","username","value","password","response","console","log","ok","json","data","access","setItem","push","alert","logoutUser","removeItem","updateToken","refresh","status","registerUser","password1","password2","contextData","fourmin","interval","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from \"react-router-dom\";\nconst AuthContext = createContext()\n\nexport default AuthContext;\n\n\nexport const AuthProvider =({children}) => {\n\n    let [authTokens, setauthTokens] = useState(()=>localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null)\n    let [user, setUser] = useState(()=>localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')) : null)\n    let [loading, setloading] = useState(true)\n\n    const history = useHistory()\n\n    let loginUser = async (e) => {\n        e.preventDefault()\n        // console.log('Form submitted')\n        let response = await fetch('http://127.0.0.1:8000/api/token/', {\n            method : 'POST',\n            headers : {\n                'Content-Type':'application/json'\n            },\n            body : JSON.stringify({'username':e.target.username.value, 'password':e.target.password.value})\n\n        })\n        console.log(response , \"response of login user\")\n        if (response.ok){\n            let data = await response.json()\n            setauthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens',JSON.stringify(data))\n            history.push('/')\n            // console.log('data:', data)\n            // console.log(\"response:\" , response);\n            // console.log(\"userrr\", user)\n        } else {\n            alert('Something went wrong!')\n            \n        }\n        // console.log('data:', response)\n    }\n\n    let logoutUser = () => {\n        setauthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n        history.push('/login')\n    }\n\n    let updateToken = async () => {\n        console.log('Update Token Called')\n        let response = await fetch('http://127.0.0.1:8000/api/token/refresh/', {\n            method : 'POST',\n            headers : {\n                'Content-Type':'application/json'\n            },\n            body : JSON.stringify({'refresh': authTokens?.refresh})\n        })\n        if (response.status === 200) {\n            let data = await response.json()\n            setauthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n        }else{\n            logoutUser()\n        }\n\n        if(loading){\n            setloading(false)\n        }\n    }\n\n    let registerUser = async (e) => {\n        e.preventDefault();\n        let response = await fetch('http://127.0.0.1:8000/api/register/', {\n            method: 'POST',\n            headers : {\n                'Content-Type' : 'application/json',\n            },\n            body : JSON.stringify({'username': e.target.username.value, 'password': e.target.password1.value, 'password2': e.target.password2.value})\n        })\n        \n        // console.log(\"response of register user\", response)\n        // if (response.status === 200){\n        //     let data = await response.json()\n            \n        // }else{\n        //     alert(response.statusText)\n        // }\n        \n    }\n\n\n    let contextData = {\n        user:user,\n        authTokens:authTokens,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n        registerUser:registerUser,\n    }\n\n\n    useEffect(()=>{\n\n        if (loading){\n            updateToken()\n\n        }\n\n        let fourmin = 1000 * 60 * 4\n        let interval = setInterval(()=> {\n            if (authTokens){\n                updateToken()\n            }\n        },fourmin)\n        // console.log(\"called\")\n        return ()=> clearInterval(interval)\n    }, [authTokens, loading])\n\n\n    return (\n        <AuthContext.Provider value={contextData} >\n            {children}\n        </AuthContext.Provider>\n    )\n}"]},"metadata":{},"sourceType":"module"}